/*! Fluffy.js 2.0.0
 *
 * Sebastian Prein
 * Copyright 2014, MIT License
 */
(function(){"use strict";function t(t,i){return i="undefined"!=typeof i?i:"debug",t=null===t?[]:Array.isArray(t)?t:[t],window.console&&console[i]?(t.forEach(function(t){}),!0):!0}function i(t){var i=[];do{var e=t.tagName.toLowerCase();t.id&&(e+="#"+t.id),t.className&&(e+="."+[].join.call(t.classList,".")),i.push(e)}while((t=t.parentNode)instanceof HTMLElement);return i.reverse().join(" > ")}function e(){var t;window.addEventListener("resize",function(){t&&clearTimeout(t),t=setTimeout(function(){g.forEach(function(t){t.updateContentSize(),t.updateContentPosition()})},100)})}window.Fluffy={},Fluffy.version="2.0.0";var s=!!document.querySelector&&!!window.addEventListener&&!!window.requestAnimationFrame,n="ontouchstart"in window,r="transform",o=["smallest","average","largest"],h=3,a={triggerSelector:null,showScrollbars:!0,smartHeight:!1,smartWidth:!1,triggerDirection:"x",mouseDamp:20,mousePadding:60},l={x:window.innerWidth,y:window.innerHeight},g=[],c=function(e){this.container=null,this.content=null,this.items=null,this.trigger=null,this.scrollbars={},this.mouse={real:{x:0,y:0},fake:{x:0,y:0},last:{x:0,y:0},observer:null},this.ratios={},this.settings={},this.sizes={},this.cleanContent=function(){for(var t=0;t<this.items.length;t++){var i=this.items[t],e=i.nextSibling,s=i.previousSibling,n=i.parentNode;null!==i&&3===i.nodeType&&n.removeChild(i),null!==s&&3===s.nodeType&&n.removeChild(s),null!==e&&3===e.nodeType&&n.removeChild(e)}},this.prepare=function(){this.cleanContent(),this.attachScrollbars(),this.mouse.observer=new d(this),this.container.style.overflow="hidden",n&&(this.container.style.webkitOverflowScrolling="touch",this.container.style.overflowX=this.settings.triggerDirection.indexOf("x")>=0?"scroll":"hidden",this.container.style.overflowY=this.settings.triggerDirection.indexOf("y")>=0?"scroll":"hidden")},this.attachScrollbars=function(){if(this.settings.showScrollbars){var t=[];this.settings.triggerDirection.indexOf("x")>=0&&t.push("horizontal"),this.settings.triggerDirection.indexOf("y")>=0&&t.push("vertical");var i=document.createElement("div");i.setAttribute("data-fluffy-scrollbars","");for(var e=0;e<t.length;e++){var s=document.createElement("span");s.classList.add("is-"+t[e]),i.appendChild(s),this.scrollbars[t[e]]=s}this.container.appendChild(i),this.container.classList.add("has-scrollbar")}},this.getContainerWidth=function(){return this.container.getBoundingClientRect().width},this.getContainerHeight=function(){return this.container.getBoundingClientRect().height},this.getTriggerWidth=function(){return this.trigger.getBoundingClientRect().width},this.getTriggerHeight=function(){return this.trigger.getBoundingClientRect().height},this.getContentWidth=function(){for(var t=0,i=0;t<this.items.length;t++)i+=this.items[t].getBoundingClientRect().width;return i},this.getContentHeight=function(){for(var t=0,i=0;t<this.items.length;t++)i+=this.items[t].getBoundingClientRect().height;return i},this.getSmartWidth=function(){for(var t={smallest:null,largest:0,average:0},i=0;i<this.items.length;i++){var e="naturalWidth"in this.items[i]?this.items[i].naturalWidth:this.items[i].getBoundingClientRect().width;t.average+=e,e>t.largest&&(t.largest=e),(null===t.smallest||e<t.smallest)&&(t.smallest=e)}return t.average/=this.items.length,t},this.getSmartHeight=function(){for(var t={smallest:null,largest:0,average:0},i=0;i<this.items.length;i++){var e="naturalHeight"in this.items[i]?this.items[i].naturalHeight:this.items[i].getBoundingClientRect().height;t.average+=e,e>t.largest&&(t.largest=e),(null===t.smallest||e<t.smallest)&&(t.smallest=e)}return t.average/=this.items.length,t},this.getScrollableHeight=function(){return this.getContentHeight()-this.getContainerHeight()},this.getScrollableWidth=function(){return this.getContentWidth()-this.getContainerWidth()},this.getMousePosition=function(t){t=t||window.event;var i=this.trigger.currentStyle||window.getComputedStyle(this.trigger,null),e=this.trigger.getBoundingClientRect(),s={left:0|i.borderLeftWidth,right:0|i.borderRightWidth,top:0|i.borderTopWidth,bottom:0|i.borderBottomWidth},n={left:e.left+s.left,right:s.left+s.right,bottom:s.top+s.bottom,top:e.top+s.top};return{x:Math.min(Math.max(0,t.clientX-n.left),e.width-n.right),y:Math.min(Math.max(0,t.clientY-n.top),e.height-n.bottom)}},this.getFakeMousePosition=function(){return{x:Math.min(Math.max(0,this.mouse.real.x-this.settings.mousePadding),this.sizes.moveArea.width)*this.ratios.moveAreaToContent.width,y:Math.min(Math.max(0,this.mouse.real.y-this.settings.mousePadding),this.sizes.moveArea.height)*this.ratios.moveAreaToContent.height}},this.cacheSizes=function(){this.sizes={container:{width:this.getContainerWidth(),height:this.getContainerHeight()},content:{width:this.getContentWidth(),height:this.getContentHeight()},scrollable:{width:this.getScrollableWidth(),height:this.getScrollableHeight()},trigger:{width:this.getTriggerWidth(),height:this.getTriggerHeight()},moveArea:{width:this.getTriggerWidth()-2*this.settings.mousePadding,height:this.getTriggerHeight()-2*this.settings.mousePadding},scrollbars:{horizontal:this.settings.showScrollbars&&this.scrollbars.horizontal?this.scrollbars.horizontal.getBoundingClientRect():null,vertical:this.settings.showScrollbars&&this.scrollbars.vertical?this.scrollbars.vertical.getBoundingClientRect():null}}},this.updateContentSize=function(){this.settings.smartWidth&&o.indexOf(this.settings.smartWidth)>=0&&(this.content.style.width=this.getSmartWidth()[this.settings.smartWidth]+"px"),this.settings.smartHeight&&o.indexOf(this.settings.smartHeight)>=0&&(this.content.style.height=this.getSmartHeight()[this.settings.smartHeight]+"px"),this.cacheSizes(),this.defineRatios(),this.settings.triggerDirection.indexOf("x")>=0&&(this.content.style.width=(100*this.ratios.containerToContent.width+.001).toFixed(h)+"%"),this.settings.triggerDirection.indexOf("y")>=0&&(this.content.style.height=(100*this.ratios.containerToContent.height+.001).toFixed(h)+"%"),(l.x!==window.innerWidth||l.y!==window.innerHeight)&&(this.mouse.real={x:this.mouse.real.x*(window.innerWidth/l.x),y:this.mouse.real.y*(window.innerHeight/l.y)},l={x:window.innerWidth,y:window.innerHeight},this.mouse.fake=this.getFakeMousePosition())},this.updateContentPosition=function(){var t=0,i=0;this.settings.triggerDirection.indexOf("x")>=0&&(t=(this.mouse.last.x/this.sizes.scrollable.width*this.ratios.contentToScrollableArea.width*100).toFixed(h)),this.settings.triggerDirection.indexOf("y")>=0&&(i=(this.mouse.last.y/this.sizes.scrollable.height*this.ratios.contentToScrollableArea.height*100).toFixed(h)),this.content.style[r]="translate(-"+t+"%, -"+i+"%)"},this.updateScrollbarPosition=function(){this.settings.showScrollbars&&(this.settings.triggerDirection.indexOf("x")>=0&&(this.scrollbars.horizontal.style.left=(this.mouse.last.x/this.sizes.scrollable.width*this.ratios.containerToScrollbarArea.width*100).toFixed(h)+"%"),this.settings.triggerDirection.indexOf("y")>=0&&(this.scrollbars.vertical.style.top=(this.mouse.last.y/this.sizes.scrollable.height*this.ratios.containerToScrollbarArea.height*100).toFixed(h)+"%"))},this.defineRatios=function(){this.ratios.moveAreaToContent={width:this.sizes.scrollable.width/this.sizes.moveArea.width,height:this.sizes.scrollable.height/this.sizes.moveArea.height},this.ratios.contentToScrollableArea={width:this.sizes.scrollable.width/this.sizes.content.width,height:this.sizes.scrollable.height/this.sizes.content.height},this.ratios.containerToContent={width:this.sizes.content.width/this.sizes.container.width,height:this.sizes.content.height/this.sizes.container.height},this.ratios.containerToScrollbarArea={width:this.sizes.scrollbars.horizontal?(this.sizes.container.width-this.sizes.scrollbars.horizontal.width)/this.sizes.container.width:0,height:this.sizes.scrollbars.vertical?(this.sizes.container.height-this.sizes.scrollbars.vertical.height)/this.sizes.container.height:0}},this.registerEventListeners=function(){window.addEventListener("load",function(){this.container&&this.container.classList.add("is-ready"),this.updateContentSize(),n||this.trigger.addEventListener("mousemove",function(t){this.mouse.observer.status()===!1&&this.mouse.observer.start(),this.mouse.real=this.getMousePosition(t),this.mouse.fake=this.getFakeMousePosition()}.bind(this))}.bind(this))},function(){var s,n=e.querySelector("[data-fluffy-content]");if(null===n)throw Error("'"+i(e)+"' has no content and therefore will be ignored.");var r={};if(e.hasAttribute("data-fluffy-options")){try{var o=JSON.parse(e.getAttribute("data-fluffy-options"));"object"!=typeof o?t(["Skipping provided options for the following container as they're not of type Object. Using defaults instead.",e],"warn"):r=o}catch(h){t(["Trying to parse options for the following container has failed. Using defaults instead.",e],"warn")}"mousePadding"in r&&r.mousePadding<0&&(r.mousePadding=a.mousePadding),"mouseDamp"in r&&r.mouseDamp<=0&&(r.mouseDamp=a.mouseDamp)}for(var l in a)l in r||(r[l]=a[l]);this.container=e,this.content=n,this.items=n.childNodes,this.trigger=r.triggerSelector&&null!==(s=document.querySelector(r.triggerSelector))?s:e,this.settings=r,this.prepare(),this.registerEventListeners()}.call(this)},d=function(t){function i(t,i){function e(){n.value=window.requestAnimationFrame(e);var r=Date.now(),o=r-s;o>=i&&(t.call(),s=Date.now())}var s=Date.now(),n={};return n.value=window.requestAnimationFrame(e),n}function e(t){window.cancelAnimationFrame(t.value)}if(t instanceof c==!1)throw Error("MouseObserver expects first parameter to be an instance of FluffyObject. Instead "+t.constructor.name+" was given.");this.start=function(){t.container.classList.add("is-moving"),this.id=i(function(){var i={x:(t.mouse.fake.x-t.mouse.last.x)/t.settings.mouseDamp,y:(t.mouse.fake.y-t.mouse.last.y)/t.settings.mouseDamp};Math.abs(i.x)<.001&&Math.abs(i.y)<.001&&(this.stop(),t.container.classList.remove("is-moving")),t.mouse.last.x+=i.x,t.mouse.last.y+=i.y,t.updateContentPosition(),t.updateScrollbarPosition()}.bind(this),10)},this.stop=function(){this.id=e(this.id)},this.status=function(){return"object"==typeof this.id}};!function(){try{if(!s)throw Error("Browser is lacking support for several requirements like: 'querySelector', 'addEventListener' or 'requestAnimationFrame'.");r=function(t){for(var i=document.createElement("div"),e=0;e<t.length;e++)if(t[e]in i.style)return t[e];throw Error("Browser doesn't support CSS3 transforms.")}(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]),n&&document.documentElement.classList.add("is-touch");var i=document.querySelectorAll("[data-fluffy-container]");if(0===i.length)return;for(var o=0;o<i.length;o++)try{g.push(new c(i[o]))}catch(h){t(h.message,"warn")}}catch(h){return t(h.message,"error")}e()}()}).call(this);