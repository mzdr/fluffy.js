/*! Fluffy.js 2.0.0
 *
 * Sebastian Prein
 * Copyright 2014, MIT License
 */
(function(){"use strict";function t(t,e){return e="undefined"!=typeof e?e:"debug",t=null===t?[]:Array.isArray(t)?t:[t],s.console&&console[e]?(t.forEach(function(t){}),!0):!0}function e(t){var e=[];do{var i=t.tagName.toLowerCase();t.id&&(i+="#"+t.id),t.className&&(i+="."+[].join.call(t.classList,".")),e.push(i)}while((t=t.parentNode)instanceof HTMLElement);return e.reverse().join(" > ")}function i(){var t;s.addEventListener("resize",function(){t&&clearTimeout(t),t=setTimeout(function(){l.forEach(function(t){t.updateContentSize()})},100)})}var s="object"==typeof exports?exports:this;s.Fluffy={},Fluffy.version="2.0.0";var n=!!document.querySelector&&!!s.addEventListener&&!!s.requestAnimationFrame,r="ontouchstart"in s,o="transform",h=["smallest","average","largest"],a={triggerSelector:null,showScrollbars:!0,smartHeight:!1,smartWidth:!1,triggerDirection:"x",mouseDamp:20,mousePadding:60},l=[],g=function(i){this.container=null,this.content=null,this.items=null,this.trigger=null,this.scrollbars={},this.mouse={real:{x:0,y:0},fake:{x:0,y:0},last:{x:0,y:0},observer:null},this.ratios={},this.settings={},this.sizes={},this.cleanContent=function(){for(var t=0;t<this.items.length;t++){var e=this.items[t],i=e.nextSibling,s=e.previousSibling,n=e.parentNode;null!==e&&3===e.nodeType&&n.removeChild(e),null!==s&&3===s.nodeType&&n.removeChild(s),null!==i&&3===i.nodeType&&n.removeChild(i)}},this.prepare=function(){this.cleanContent(),this.attachScrollbars(),this.mouse.observer=new c(this),this.container.style.overflow="hidden",r&&(this.container.style.webkitOverflowScrolling="touch",this.container.style.overflowX=this.settings.triggerDirection.indexOf("x")>=0?"scroll":"hidden",this.container.style.overflowY=this.settings.triggerDirection.indexOf("y")>=0?"scroll":"hidden")},this.attachScrollbars=function(){if(this.settings.showScrollbars){var t=[];this.settings.triggerDirection.indexOf("x")>=0&&t.push("horizontal"),this.settings.triggerDirection.indexOf("y")>=0&&t.push("vertical");var e=document.createElement("div");e.setAttribute("data-fluffy-scrollbars","");for(var i=0;i<t.length;i++){var s=document.createElement("span");s.classList.add("is-"+t[i]),e.appendChild(s),this.scrollbars[t[i]]=s}this.container.appendChild(e),this.container.classList.add("has-scrollbar")}},this.getContainerWidth=function(){return this.container.getBoundingClientRect().width},this.getContainerHeight=function(){return this.container.getBoundingClientRect().height},this.getTriggerWidth=function(){return this.trigger.getBoundingClientRect().width},this.getTriggerHeight=function(){return this.trigger.getBoundingClientRect().height},this.getContentWidth=function(){for(var t=0,e=0;t<this.items.length;t++)e+=this.items[t].getBoundingClientRect().width;return e},this.getContentHeight=function(){for(var t=0,e=0;t<this.items.length;t++)e+=this.items[t].getBoundingClientRect().height;return e},this.getSmartWidth=function(){for(var t={smallest:this.items[0].naturalWidth,largest:0,average:0},e=0;e<this.items.length;e++)t.average+=this.items[e].naturalWidth,this.items[e].naturalWidth>t.largest&&(t.largest=this.items[e].naturalWidth),this.items[e].naturalWidth<t.smallest&&(t.smallest=this.items[e].naturalWidth);return t.average/=this.items.length,t},this.getSmartHeight=function(){for(var t={smallest:this.items[0].naturalHeight,largest:0,average:0},e=0;e<this.items.length;e++)t.average+=this.items[e].naturalHeight,this.items[e].naturalHeight>t.largest&&(t.largest=this.items[e].naturalHeight),this.items[e].naturalHeight<t.smallest&&(t.smallest=this.items[e].naturalHeight);return t.average/=this.items.length,t},this.getScrollableHeight=function(){return this.getContentHeight()-this.getContainerHeight()},this.getScrollableWidth=function(){return this.getContentWidth()-this.getContainerWidth()},this.getMousePosition=function(t){t=t||s.event;var e=this.trigger.currentStyle||s.getComputedStyle(this.trigger,null),i=this.trigger.getBoundingClientRect(),n={left:0|e.borderLeftWidth,right:0|e.borderRightWidth,top:0|e.borderTopWidth,bottom:0|e.borderBottomWidth},r={left:i.left+n.left,right:n.left+n.right,bottom:n.top+n.bottom,top:i.top+n.top};return{x:Math.min(Math.max(0,t.clientX-r.left),i.width-r.right),y:Math.min(Math.max(0,t.clientY-r.top),i.height-r.bottom)}},this.getFakeMousePosition=function(){return{x:Math.min(Math.max(0,this.mouse.real.x-this.settings.mousePadding),this.sizes.moveArea.width)*this.ratios.moveAreaToContent.width,y:Math.min(Math.max(0,this.mouse.real.y-this.settings.mousePadding),this.sizes.moveArea.height)*this.ratios.moveAreaToContent.height}},this.cacheSizes=function(){this.sizes={container:{width:this.getContainerWidth(),height:this.getContainerHeight()},content:{width:this.getContentWidth(),height:this.getContentHeight()},scrollable:{width:this.getScrollableWidth(),height:this.getScrollableHeight()},trigger:{width:this.getTriggerWidth(),height:this.getTriggerHeight()},moveArea:{width:this.getTriggerWidth()-2*this.settings.mousePadding,height:this.getTriggerHeight()-2*this.settings.mousePadding},scrollbars:{horizontal:this.settings.showScrollbars&&this.scrollbars.horizontal?this.scrollbars.horizontal.getBoundingClientRect():null,vertical:this.settings.showScrollbars&&this.scrollbars.vertical?this.scrollbars.vertical.getBoundingClientRect():null}}},this.updateContentSize=function(){this.settings.smartWidth&&h.indexOf(this.settings.smartWidth)>=0&&(this.content.style.width=this.getSmartWidth()[this.settings.smartWidth]+"px"),this.settings.smartHeight&&h.indexOf(this.settings.smartHeight)>=0&&(this.content.style.height=this.getSmartHeight()[this.settings.smartHeight]+"px"),this.cacheSizes(),this.defineRatios(),this.settings.triggerDirection.indexOf("x")>=0&&(this.content.style.width=100*this.ratios.containerToContent.width+"%"),this.settings.triggerDirection.indexOf("y")>=0&&(this.content.style.height=100*this.ratios.containerToContent.height+"%")},this.updateContentPosition=function(){var t=this.settings.triggerDirection.indexOf("x")>=0?-this.mouse.last.x/this.sizes.scrollable.width*this.ratios.contentToScrollableArea.width*100:0,e=this.settings.triggerDirection.indexOf("y")>=0?-this.mouse.last.y/this.sizes.scrollable.height*this.ratios.contentToScrollableArea.height*100:0;this.content.style[o]="translate("+t+"%, "+e+"%)"},this.updateScrollbarPosition=function(){this.settings.showScrollbars&&(this.settings.triggerDirection.indexOf("x")>=0&&(this.scrollbars.horizontal.style.left=this.mouse.last.x/this.sizes.scrollable.width*(1-this.sizes.scrollbars.horizontal.width/this.sizes.container.width)*100+"%"),this.settings.triggerDirection.indexOf("y")>=0&&(this.scrollbars.vertical.style.top=this.mouse.last.y/this.sizes.scrollable.height*(1-this.sizes.scrollbars.vertical.height/this.sizes.container.height)*100+"%"))},this.defineRatios=function(){this.ratios.moveAreaToContent={width:this.sizes.scrollable.width/this.sizes.moveArea.width,height:this.sizes.scrollable.height/this.sizes.moveArea.height},this.ratios.contentToScrollableArea={width:this.sizes.scrollable.width/this.sizes.content.width,height:this.sizes.scrollable.height/this.sizes.content.height},this.ratios.containerToContent={width:this.sizes.content.width/this.sizes.container.width,height:this.sizes.content.height/this.sizes.container.height}},this.registerEventListeners=function(){s.addEventListener("load",function(){this.container&&this.container.classList.add("is-ready"),this.updateContentSize(),r||this.trigger.addEventListener("mousemove",function(t){this.mouse.observer.status()===!1&&this.mouse.observer.start(),this.mouse.real=this.getMousePosition(t),this.mouse.fake=this.getFakeMousePosition()}.bind(this))}.bind(this))},function(){var s,n=i.querySelector("[data-fluffy-content]");if(null===n)throw Error("'"+e(i)+"' has no content and therefore will be ignored.");var r={};if(i.hasAttribute("data-fluffy-options")){try{var o=JSON.parse(i.getAttribute("data-fluffy-options"));"object"!=typeof o?t(["Skipping provided options for the following container as they're not of type Object. Using defaults instead.",i],"warn"):r=o}catch(h){t(["Trying to parse options for the following container has failed. Using defaults instead.",i],"warn")}void 0!==r.mousePadding&&r.mousePadding<0&&(r.mousePadding=a.mousePadding),void 0!==r.mouseDamp&&r.mouseDamp<=0&&(r.mouseDamp=a.mouseDamp)}for(var l in a)void 0===r[l]&&(r[l]=a[l]);this.container=i,this.content=n,this.items=n.childNodes,this.trigger=r.triggerSelector&&null!==(s=document.querySelector(r.triggerSelector))?s:i,this.settings=r,this.prepare(),this.registerEventListeners()}.call(this)},c=function(t){function e(t,e){function i(){r.value=s.requestAnimationFrame(i);var o=Date.now(),h=o-n;h>=e&&(t.call(),n=Date.now())}var n=Date.now(),r={};return r.value=s.requestAnimationFrame(i),r}function i(t){s.cancelAnimationFrame(t.value)}if(t instanceof g==!1)throw Error("MouseObserver expects first parameter to be an instance of FluffyObject. Instead "+t.constructor.name+" was given.");this.start=function(){t.container.classList.add("is-moving"),this.id=e(function(){var e={x:(t.mouse.fake.x-t.mouse.last.x)/t.settings.mouseDamp,y:(t.mouse.fake.y-t.mouse.last.y)/t.settings.mouseDamp};this.status()&&Math.abs(e.x)<.001&&Math.abs(e.y)<.001&&(this.stop(),t.container.classList.remove("is-moving")),t.mouse.last.x+=e.x,t.mouse.last.y+=e.y,t.updateContentPosition(),t.settings.showScrollbars&&t.updateScrollbarPosition()}.bind(this),10)},this.stop=function(){this.id=i(this.id)},this.status=function(){return"object"==typeof this.id}};!function(){try{if(!n)throw Error("Browser is lacking support for several requirements like: 'querySelector', 'addEventListener' or 'requestAnimationFrame'.");o=function(t){for(var e=document.createElement("div"),i=0;i<t.length;i++)if("undefined"!=typeof e.style[t[i]])return t[i];throw Error("Browser doesn't support CSS3 transforms.")}(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]);var e=document.querySelectorAll("[data-fluffy-container]");if(0===e.length)return;for(var s=0;s<e.length;s++)try{l.push(new g(e[s]))}catch(r){t(r.message,"warn")}}catch(r){return t(r.message,"error")}i()}()}).call(this);